<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="referrer" content="no-referrer">
  <meta name="google-site-verification" content="i-9rnKTO55VrWDag6iP74KddaTXU6YZylRl3rzB8cik" />
  

  <link rel="icon" type="image/png" href="/favicon.png">

  <title>
    
    
     r h2o introduction 
    
  </title>
  <link rel="canonical" href="/post/r-h2o-introduction/">

  <link rel="stylesheet" href="/css/fonts.css" />
  <link rel="stylesheet" href="/css/style.css" />

  
</head>

<body>
<section id=nav>
  <h1><a href="/">orrymr.com</a></h1>
  <ul>
    
    <li><a href="http://orrymr.com">Home</a></li>
    
    <li><a href="https://github.com/orrymr">GitHub</a></li>
    
    <li><a href="#">Music</a></li>
    
    <li><a href="#">About</a></li>
    
    <li><a href="https://twitter.com/orrymr">Twitter</a></li>
    
    <li><a href="/index.xml">RSS</a></li>
    
  </ul>
</section>


<section id=content>
  <h1> r h2o introduction </h1>

  <div id=sub-header>
     · 2018/12/04 · 8 minute read
  </div>

  <div class="entry-content">
    


<div id="introduction" class="section level1">
<h1>1. Introduction</h1>
<p><a href="https://www.h2o.ai/">H2O</a> <a href="https://github.com/h2oai/h2o-3">“is an in-memory platform for distributed, scalable machine learning.”</a>. In this post we unpack what this statement means, and get started working with H2O using R.</p>
</div>
<div id="what-is-h2o" class="section level1">
<h1>2. What is H2O?</h1>
<p>The definition found on H2O’s Github page is a lot to take in, especially if you’re just starting out with H2O (like I am!): “H2O is an in-memory platform for distributed, scalable machine learning. H2O uses familiar interfaces like R, Python, Scala, Java, JSON and the Flow notebook/web interface, and works seamlessly with big data technologies like Hadoop and Spark.”</p>
<p>Let’s break down this statement piece by piece.</p>
<div id="h2o-is-an-in-memory-platform" class="section level2">
<h2>2.1 H2O is an In-Memory Platform</h2>
<p>They start off by telling us that H2O is an “<strong>in-memory platform</strong>”. Saying that it’s in-memory means that the data and software being used is in main memory (RAM). Main memory, or <strong>primary memory</strong> is typically much faster than secondary memory (such as a hard drive). A software platform is typically something which can be used to build something. We happen to know that this platform is used for building machine learning models. Putting this togther we now know that H2O is an in-memory environment for building machine learning models.</p>
</div>
<div id="h2o-is-distributed-and-scalable" class="section level2">
<h2>2.2 H2O is distributed and Scalable</h2>
<p><strong>“…for distributed, scalable machine learning”</strong></p>
<p>H2O runs on clusters. Although I haven’t actually tried this (yet), I’ve read that H2O works on clusters such as Hadoop. It’s something that I still need to experiment with, and when I do, I’ll post a link here. So, for now, I’m just going to interpret the phrase “distributed, scalable machine learning” as saying that we can run the H2O platform on a cluster.</p>
<p>One thing to note, is that H2O uses what’s known as a Distributed Key Value (DKV). You can read more about it <a href="https://www.h2o.ai/blog/h2o-architecture/">here</a>, but essentially what this means, is that any object you create in H2O can be distributed amongst several nodes in the cluster. Of course, if you aren’t using a cluster - and just using a laptop, like I did with the example that follows - you need need to have enough memory to hold your objects locally. Whether you are using a cluster, or running locally, once you’ve imported your data into the H2O platform, you get back a hexadecimal key which you can then use to access your data.</p>
<p>So, <strong>Distributed Key Value</strong>: It’s distributed because your object can be spread amongst several nodes in your cluster. And the key-value part means that you get back a key into what is effectively a hashmap to your object.</p>
<p>This part doesn’t flow nicely into the next</p>
</div>
</div>
<div id="how-h2o-runs-under-the-hood" class="section level1">
<h1>3. How H2O runs under the hood</h1>
<p>You can install H2O using R: <code>install.packages(&quot;h2o&quot;)</code>. If you’re having trouble with this, <a href="http://h2o-release.s3.amazonaws.com/h2o/rel-xia/2/index.html">have a look here.</a></p>
<p>We spoke earlier about H2O being a platform. It’s important to distinguish between the R <strong><em>interface</em></strong> for H2O, and H2O itself. H2O can exist perfectly fine without R. H2O is just a <a href="https://en.wikipedia.org/wiki/JAR_(file_format)">.jar</a> which can run on its own. If you don’t know (or particularly care) what a .jar is - just think of it as a java program packaged with all the stuff it needs to run.</p>
<p>When you start H2O, you actually create a server which can respond to <a href="https://en.wikipedia.org/wiki/Representational_state_transfer">REST</a> calls. Again, you don’t really need to know how REST works in order to use H2O. But if you do care, just know that you can use any HTTP client to speak with an H2O instance.</p>
<p>R is just a client interfact for H2O. All the R functions you call when working with H2O are actually calling H2O using a REST API (a JSON POST request) under the hood. The Python H2O library, as well as the Flow UI (link here) interfaces with H2O in a similar way. <strong>If this is all very confusing just think about it like this: you use R to send commands to H2O.</strong> You could equally just use Flow or Python to send commands.</p>
<p>Data is not in R, R only has a pointer to the data.</p>
<p>Distributed Frame (15 minutes into the video)</p>
<p>Essentially, when reading in a csv, or data in general, you get back a pointer to the (potentially distributed) h2oFrame.</p>
<p>So, it seems like when you manipulate an H2O dataframe, even using syntax like you would with a normal df, like <code>filtered &lt;- my_df[bleh &gt; 3, ]</code>, that it is actually doing this on the h2o instance. You send the command to the h2o server.</p>
<p><a href="https://www.h2o.ai/blog/h2o-architecture/" class="uri">https://www.h2o.ai/blog/h2o-architecture/</a></p>
</div>
<div id="running-an-example" class="section level1">
<h1>4. Running An Example</h1>
<p>First we’ll need to load the packages we’ll be using: <code>h2o</code> and <code>datasets</code>. We load the latter as we’ll be using the famous <a href="https://en.wikipedia.org/wiki/Iris_flower_data_set">iris dataset</a>, which is part of the <code>datasets</code> package.</p>
<pre class="r"><code>library(datasets)
library(h2o)</code></pre>
<pre><code>## 
## ----------------------------------------------------------------------
## 
## Your next step is to start H2O:
##     &gt; h2o.init()
## 
## For H2O package documentation, ask for help:
##     &gt; ??h2o
## 
## After starting H2O, you can use the Web UI at http://localhost:54321
## For more information visit http://docs.h2o.ai
## 
## ----------------------------------------------------------------------</code></pre>
<pre><code>## 
## Attaching package: &#39;h2o&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     cor, sd, var</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     %*%, %in%, &amp;&amp;, ||, apply, as.factor, as.numeric, colnames,
##     colnames&lt;-, ifelse, is.character, is.factor, is.numeric, log,
##     log10, log1p, log2, round, signif, trunc</code></pre>
<p>The Iris Dataset contains attributes of three species of iris flowers.</p>
<p>Let’s load the iris dataset, and start up our H2O instance:</p>
<pre class="r"><code>h2o.init(nthreads = -1) </code></pre>
<pre><code>##  Connection successful!
## 
## R is connected to the H2O cluster: 
##     H2O cluster uptime:         41 minutes 27 seconds 
##     H2O cluster timezone:       Africa/Harare 
##     H2O data parsing timezone:  UTC 
##     H2O cluster version:        3.20.0.8 
##     H2O cluster version age:    2 months and 19 days  
##     H2O cluster name:           H2O_started_from_R_ORRY1_wgj000 
##     H2O cluster total nodes:    1 
##     H2O cluster total memory:   3.51 GB 
##     H2O cluster total cores:    8 
##     H2O cluster allowed cores:  8 
##     H2O cluster healthy:        TRUE 
##     H2O Connection ip:          localhost 
##     H2O Connection port:        54321 
##     H2O Connection proxy:       NA 
##     H2O Internal Security:      FALSE 
##     H2O API Extensions:         Algos, AutoML, Core V3, Core V4 
##     R Version:                  R version 3.5.1 (2018-07-02)</code></pre>
<pre class="r"><code>data(iris)</code></pre>
<p>By default, H2O starts up using 2 cores. By calling <code>h2o.init(nthreads = -1)</code>, we use all available cores.</p>
<p>If <code>h2o.init()</code> was succesful, you should have an instance of H2O running locally! You can verify this by navigating to <a href="http://localhost:54321" class="uri">http://localhost:54321</a>. Here, you should see the Flow UI.</p>
<p>The iris dataset is now loaded into R. It’s not yet in H2O. Let’s go ahead and load the iris data into our H2O instance:</p>
<pre class="r"><code>iris.hex &lt;- as.h2o(iris)</code></pre>
<pre><code>## 
  |                                                                       
  |                                                                 |   0%
  |                                                                       
  |=================================================================| 100%</code></pre>
<pre class="r"><code>h2o.ls()</code></pre>
<pre><code>##               key
## 1 RTMP_sid_9200_6
## 2            iris</code></pre>
<p><code>h2o.ls()</code> lists the dataframes you have loaded into H2O. Right now, you should see only one: iris.</p>
<p>Let’s start investigating this dataframe. We can get the summary statistics of the various factors:</p>
<pre class="r"><code>h2o.describe(iris.hex)</code></pre>
<pre><code>##          Label Type Missing Zeros PosInf NegInf Min Max     Mean     Sigma
## 1 Sepal.Length real       0     0      0      0 4.3 7.9 5.843333 0.8280661
## 2  Sepal.Width real       0     0      0      0 2.0 4.4 3.057333 0.4358663
## 3 Petal.Length real       0     0      0      0 1.0 6.9 3.758000 1.7652982
## 4  Petal.Width real       0     0      0      0 0.1 2.5 1.199333 0.7622377
## 5      Species enum       0    50      0      0 0.0 2.0       NA        NA
##   Cardinality
## 1          NA
## 2          NA
## 3          NA
## 4          NA
## 5           3</code></pre>
<p>We can also use H2O to plot histograms:</p>
<pre class="r"><code>h2o.hist(iris.hex$Sepal.Length)</code></pre>
<p><img src="/post/2018-12-04-r-h2o-introduction_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>You can use familiar R syntax to modify your H2O dataframe:</p>
<pre class="r"><code>iris.hex$bleh &lt;- iris.hex$Sepal.Length + 2</code></pre>
<p>If we now run <code>h2o.describe(iris.hex)</code>, we should see this extra variable:</p>
<pre class="r"><code>h2o.describe(iris.hex)</code></pre>
<pre><code>##          Label Type Missing Zeros PosInf NegInf Min Max     Mean     Sigma
## 1 Sepal.Length real       0     0      0      0 4.3 7.9 5.843333 0.8280661
## 2  Sepal.Width real       0     0      0      0 2.0 4.4 3.057333 0.4358663
## 3 Petal.Length real       0     0      0      0 1.0 6.9 3.758000 1.7652982
## 4  Petal.Width real       0     0      0      0 0.1 2.5 1.199333 0.7622377
## 5      Species enum       0    50      0      0 0.0 2.0       NA        NA
## 6         bleh real       0     0      0      0 6.3 9.9 7.843333 0.8280661
##   Cardinality
## 1          NA
## 2          NA
## 3          NA
## 4          NA
## 5           3
## 6          NA</code></pre>
<p>(What I still don’t understand is why we don’t see this extra column from the Flow UI. If anyone knows, please let me know in the comments!)</p>
<p>But we don’t really need this nonsense column, so let’s get rid of it:</p>
<pre class="r"><code>iris.hex$bleh &lt;- NULL</code></pre>
<p>We can also get our dataframe back into R, from H2O:</p>
<pre class="r"><code>r_df &lt;- as.data.frame(iris.hex)</code></pre>
<pre class="r"><code># h2o.levels(iris.hex$Species)
# # Note, if you get the error &quot;Error in chk.H2OFrame(x) : must be an H2OFrame&quot; - check that you spelled the column name correctly, case sensitive and all
# 
# 
# 
# splits &lt;- h2o.splitFrame(data = iris.hex, 
#                          ratios = c(0.7, 0.15),  #partition data into 70%, 15%, 15% chunks
#                          seed = 198) 
# 
# train &lt;- splits[[1]]
# valid &lt;- splits[[2]]
# test &lt;- splits[[3]]
# 
# #seed changes the ratio. ratio seems to be not exact thing.
# #h2o uses approximate splitting
# 
# rf &lt;- h2o.randomForest(x = c(&quot;Sepal.Length&quot;, &quot;Sepal.Width&quot;, &quot;Petal.Length&quot;, &quot;Petal.Width&quot;), 
#                     y = c(&quot;Species&quot;), 
#                     training_frame = train,
#                     model_id = &quot;our.rf&quot;)
# 
# rf_perf1 &lt;- h2o.performance(model = rf,
#                             newdata = test)


#keep going through: https://github.com/h2oai/h2o-tutorials/blob/master/h2o-open-tour-2016/chicago/intro-to-h2o.R
# read this: http://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science/drf.html</code></pre>
</div>
<div id="conclusion" class="section level1">
<h1>5. Conclusion</h1>
<p>Link the final code here</p>
<p><a href="https://github.com/h2oai/h2o-tutorials/blob/master/h2o-open-tour-2016/chicago/intro-to-h2o.R" class="uri">https://github.com/h2oai/h2o-tutorials/blob/master/h2o-open-tour-2016/chicago/intro-to-h2o.R</a></p>
</div>

  </div>

  <div id=links>
    
      <a class="basic-alignment left" href="/post/inverse-matrix/">&laquo; Inverse Matrices - A Primer</a>
    
    
  </div>
</section>

<section id="comments">
<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
      
      
      if (window.location.hostname == "localhost")
                return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'orrymr';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>


  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-115127992-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  
<script src="/js/math-code.js"></script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>



</body>
</html>

